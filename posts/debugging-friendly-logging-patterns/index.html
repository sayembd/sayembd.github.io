<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>On-call-friendly Java Logging Patterns | Random Musings</title><meta name=keywords content><meta name=description content="In this blog post I will talk about a few on-call-friendly logging patterns that have served me well throughout my career."><meta name=author content><link rel=canonical href=https://www.sayemahmed.com/posts/debugging-friendly-logging-patterns/><link crossorigin=anonymous href=/assets/css/stylesheet.min.05454d598f87e0c631d67ac68ed91c748c4f8cc32ce6b01b10afd02b558bc5ca.css integrity="sha256-BUVNWY+H4MYx1nrGjtkcdIxPjMMs5rAbEK/QK1WLxco=" rel="preload stylesheet" as=style><link rel=icon href=https://www.sayemahmed.com/favicon.ico><link rel=apple-touch-icon href=https://www.sayemahmed.com/apple-touch-icon.png><meta name=twitter:title content="On-call-friendly Java Logging Patterns | Random Musings"><meta name=twitter:description content="In this blog post I will talk about a few on-call-friendly logging patterns that have served me well throughout my career."><meta property="og:title" content="On-call-friendly Java Logging Patterns | Random Musings"><meta property="og:description" content="In this blog post I will talk about a few on-call-friendly logging patterns that have served me well throughout my career."><meta property="og:type" content="article"><meta property="og:url" content="https://www.sayemahmed.com/posts/debugging-friendly-logging-patterns/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-28T23:12:11+02:00"><meta property="article:modified_time" content="2023-01-28T23:12:11+02:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.sayemahmed.com/posts/"},{"@type":"ListItem","position":3,"name":"On-call-friendly Java Logging Patterns","item":"https://www.sayemahmed.com/posts/debugging-friendly-logging-patterns/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"On-call-friendly Java Logging Patterns | Random Musings","name":"On-call-friendly Java Logging Patterns","description":"In this blog post I will talk about a few on-call-friendly logging patterns that have served me well throughout my career.","keywords":[],"wordCount":"989","inLanguage":"en","datePublished":"2023-01-28T23:12:11+02:00","dateModified":"2023-01-28T23:12:11+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sayemahmed.com/posts/debugging-friendly-logging-patterns/"},"publisher":{"@type":"Organization","name":"Random Musings","logo":{"@type":"ImageObject","url":"https://www.sayemahmed.com/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="light",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://www.sayemahmed.com accesskey=h title="Random Musings (Alt + H)">Random Musings</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.sayemahmed.com/about-me/ title="About Me">About Me</a></li><li><a href=https://www.sayemahmed.com/index.xml/ title=RSS>RSS</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>On-call-friendly Java Logging Patterns</h1><div class=post-description>In this blog post I will talk about a few on-call-friendly logging patterns that have served me well throughout my career.</div><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>January 28, 2023</span></span></div></header><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>¶</a></h1><p>Logging is an essential part of any modern Java application. Logs allow us to understand the runtime behaviour of our applications. They also help us capture the context when errors occur. Without logging debugging a production issue will often be quite tricky. Throughout my career, I have found specific logging patterns more valuable than others when on-call. And some - not so much. In this blog post, I will talk about a few of them with examples.</p><h1 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>¶</a></h1><p>All patterns or anti-patterns always have an associated context. In the following discussion, I assume a high-traffic web application is doing all the logging. By &ldquo;high-traffic&rdquo;, I mean a web application serving at least 30K requests per second.</p><h1 id=1-avoiding-duplicate-error-logs-while-preserving-the-context>1. Avoiding duplicate error logs while preserving the context<a hidden class=anchor aria-hidden=true href=#1-avoiding-duplicate-error-logs-while-preserving-the-context>¶</a></h1><p>Consider the following code -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>SomeResult</span> <span class=nf>performSomeOperation</span><span class=o>(</span><span class=n>SomeData</span> <span class=n>someData</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>someService</span><span class=o>.</span><span class=na>doSomething</span><span class=o>(</span><span class=n>someData</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>SomeCommonException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Error occurred. Data - {}&#34;</span><span class=o>,</span> <span class=n>someData</span><span class=o>,</span> <span class=n>ex</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>AnotherCommonException</span><span class=o>(</span><span class=s>&#34;Some error occurred&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>There are two reasons this pattern is not helpful when I am on call. First, it results in unnecessary noise in the production log. In this example, we log an error message immediately after catching the exception. But then we are throwing a new exception - <code>AnotherCommonException</code>. Now the client of &ldquo;performSomeOperation&rdquo; would need to deal with this exception -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>SomeResult</span> <span class=nf>clientOfPerformSomeOperation</span><span class=o>(</span><span class=n>SomeData</span> <span class=n>someData</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>someService</span><span class=o>.</span><span class=na>performSomeOperation</span><span class=o>(</span><span class=n>someData</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>AnotherCommonException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// log it? Throw a new error? Do both?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>In the worst case, each client will log an error message and rethrow the exception. As a result, we will end up with two or more log messages for a single error. If 1% of the incoming requests encounter <code>SomeCommonException</code>, then that would mean six hundred error logs per second being logged, three hundred of which are duplicates. That&rsquo;s a lot of unnecessary error messages! On top of that, a 1% failure is often considered acceptable in a distributed application, in which case logging these &ldquo;acceptable failures&rdquo; might even mislead me to think that this might be the source of an active alert.</p><p>The second reason is that we have no link between the root cause and the follow-up exception. For a high-traffic application, the first and the second log message will be far apart in the production log. And chances of linking them together will be low. As a result, the production log will contain random exceptions without any context, which might also be a source of misdirection for me.</p><p>The on-call-friendlier version of the above example would be -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>SomeResult</span> <span class=nf>performSomeOperation</span><span class=o>(</span><span class=n>SomeData</span> <span class=n>someData</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>someService</span><span class=o>.</span><span class=na>doSomething</span><span class=o>(</span><span class=n>someData</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>SomeCommonException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>AnotherCommonException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Error occurred. Data - {}&#34;</span> <span class=o>+</span> <span class=n>someData</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>ex</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>This logging does not have the above problems. It does not create duplicate log messages. It also preserves the original error context. Identifying and filtering them out from the log is also relatively easy.</p><p>Having precisely one log message per error has other advantages. It makes it easy to count the exact number of errors at a particular time. If the exception is occurring due to a timed-out API call, then searching the log for <code>ERROR</code> levels within a, say, 30-minute time window will return the exact number of failed API calls within the period.</p><h1 id=2-logging-acceptable-failures-with-warn-level>2. Logging &ldquo;acceptable failures&rdquo; with WARN level<a hidden class=anchor aria-hidden=true href=#2-logging-acceptable-failures-with-warn-level>¶</a></h1><p>Consider the following API call -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>restTemplate</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;https://httpstat.us/500&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span><span class=o>.</span><span class=na>class</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Error occurred&#34;</span><span class=o>,</span> <span class=n>ex</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;A default response&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><a href=https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing>Making remote API calls 100% reliable is practically impossible</a>. And so it&rsquo;s expected that a certain percentage of this call will fail. For our high-traffic web application, a 0.5% failure rate here would mean 150 errors per second. Logging each one as an error would thus generate high-volume noise in the production log.</p><p>Rather than logging it as an error, I would rather recommend logging it as a WARN -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>restTemplate</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;https://httpstat.us/500&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span><span class=o>.</span><span class=na>class</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=na>warn</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;API call failure. Context data should also be logged&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>ex</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;A default response&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Logging these failures as WARN still tracks our API failures while at the same time making it easy to filter them out.</p><p>This example also demonstrates one of my logging heuristics - I always consider an ERROR log worthy of keeping me awake at night. If this is not the case, I will not log it as an ERROR.</p><h1 id=3-avoid-logging-validation-failures-as-errors>3. Avoid logging validation failures as errors<a hidden class=anchor aria-hidden=true href=#3-avoid-logging-validation-failures-as-errors>¶</a></h1><p>Consider the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SomeController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;?&gt;</span> <span class=n>createOrder</span><span class=o>(</span><span class=n>OrderDTO</span> <span class=n>dto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>var</span> <span class=n>validationResult</span> <span class=o>=</span> <span class=n>validateDto</span><span class=o>(</span><span class=n>dto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>validationResult</span><span class=o>.</span><span class=na>hasError</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=s>&#34;Validation error: {}&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>validationResult</span><span class=o>.</span><span class=na>toError</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>badRequest</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// create order logic
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Logging a validation error as an error in the log is 100% noise. Validation errors represent an incomplete request; the application cannot process the request in its current form. And so, logging these requests as errors only pollute the log. I recommend removing this logging altogether.</p><p>There is a rare exception to this. Often, clients would ask for a log of a particular request to debug their code. For example, if this API serves mobile apps and there is a logical bug in the validation on the mobile app, then this error logging might be helpful. In that case, we might consider keeping this log but with a different level -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SomeController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>ResponseEntity</span><span class=o>&lt;?&gt;</span> <span class=n>createOrder</span><span class=o>(</span><span class=n>OrderDTO</span> <span class=n>dto</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>var</span> <span class=n>validationResult</span> <span class=o>=</span> <span class=n>validateDto</span><span class=o>(</span><span class=n>dto</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>validationResult</span><span class=o>.</span><span class=na>hasError</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Validation error: {}&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>validationResult</span><span class=o>.</span><span class=na>toError</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>ResponseEntity</span><span class=o>.</span><span class=na>badRequest</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// create order logic
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>This logging might be acceptable if the web application receives a low traffic volume. For a high-traffic website, this would, however, require a considerable amount of log storage. In such cases, it is always better to rely on <a href=https://www.sayemahmed.com/posts/how-to-build-observable-system-an-introduction-to-observability/>an observability tool</a> which can perform after-the-fact sampling (sampling 1% of the requests that generate 400).</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.sayemahmed.com/posts/unwinding-the-abstraction-how-does-arraylist-in-java-work/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Unwinding the Abstraction - How does ArrayList in Java Work?</span></a>
<a class=next href=https://www.sayemahmed.com/posts/how-to-build-observable-system-an-introduction-to-observability/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>How to Build Observable Systems - An Introduction to Observability</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.sayemahmed.com>Random Musings</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a></span>
<span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>