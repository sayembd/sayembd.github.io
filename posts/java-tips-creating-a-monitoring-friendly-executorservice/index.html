<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Java Tips: Creating a Monitoring-friendly ExecutorService · Random Musings
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="MD Sayem Ahmed">
<meta name="description" content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities.">
<meta name="keywords" content="blog,developer,personal">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Java Tips: Creating a Monitoring-friendly ExecutorService">
  <meta name="twitter:description" content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities.">

<meta property="og:url" content="https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/">
  <meta property="og:site_name" content="Random Musings">
  <meta property="og:title" content="Java Tips: Creating a Monitoring-friendly ExecutorService">
  <meta property="og:description" content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-05-01T03:15:21+02:00">
    <meta property="article:modified_time" content="2018-05-01T03:15:21+02:00">




<link rel="canonical" href="https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css" integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://www.sayemahmed.com/">
      Random Musings
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/">
              Java Tips: Creating a Monitoring-friendly ExecutorService
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2018-05-01T03:15:21&#43;02:00">
                May 1, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              6-minute read
            </span>
          </div>
          
          
          
        </div>
      </header>

      <div class="post-content">
        
        <p>In this article we will be extending an <a href="https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ExecutorService.html"  class="external-link" target="_blank" rel="noopener">ExecutorService</a> implementation with monitoring capabilities. This monitoring capability will help us to measure a number of pool parameters i.e., active threads, work queue size etc. in a live production environment. It will also enable us to measure task execution time, successful tasks count, and failed tasks count.</p>
<h2 id="monitoring-library">
  Monitoring Library
  <a class="heading-link" href="#monitoring-library">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>As for the monitoring library we will be using <a href="http://metrics.dropwizard.io/"  class="external-link" target="_blank" rel="noopener">Metrics</a>. For the sake of simplicity we will be using a <a href="http://metrics.dropwizard.io/4.0.0/apidocs/com/codahale/metrics/ConsoleReporter.html"  class="external-link" target="_blank" rel="noopener">ConsoleReporter</a> which will report our metrics to the console. For production-grade applications, we should use an advanced reporter (i.e., Graphite reporter). If you are unfamiliar with Metrics, then I recommend you to go through the <a href="http://metrics.dropwizard.io/4.0.0/getting-started.html"  class="external-link" target="_blank" rel="noopener">getting started guide</a>.</p>
<p>Let&rsquo;s get started.</p>
<h2 id="extending-the-threadpoolexecutor">
  Extending the ThreadPoolExecutor
  <a class="heading-link" href="#extending-the-threadpoolexecutor">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>We will be using <a href="https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ThreadPoolExecutor.html"  class="external-link" target="_blank" rel="noopener">ThreadPoolExecutor</a> as the base class for our new type. Let&rsquo;s call it <em>MonitoredThreadPoolExecutor</em>. This class will accept a <a href="http://metrics.dropwizard.io/4.0.0/apidocs/com/codahale/metrics/MetricRegistry.html"  class="external-link" target="_blank" rel="noopener">MetricRegistry</a> as one of its constructor parameters -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">MonitoredThreadPoolExecutor</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">extends</span><span style="color:#6e7681"> </span>ThreadPoolExecutor<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">final</span><span style="color:#6e7681"> </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>ThreadFactory<span style="color:#6e7681"> </span>threadFactory,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681"> </span>threadFactory);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>RejectedExecutionHandler<span style="color:#6e7681"> </span>handler,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681"> </span>handler);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>ThreadFactory<span style="color:#6e7681"> </span>threadFactory,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>RejectedExecutionHandler<span style="color:#6e7681"> </span>handler,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681"> </span>threadFactory,<span style="color:#6e7681"> </span>handler);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h2 id="registering-gauges-to-measure-pool-specific-paramters">
  Registering Gauges to measure pool-specific paramters
  <a class="heading-link" href="#registering-gauges-to-measure-pool-specific-paramters">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>A <a href="http://metrics.dropwizard.io/4.0.0/getting-started.html#gauges"  class="external-link" target="_blank" rel="noopener">Gauge</a> is an instantaneous measurement of a value. We will be using it to measure different pool parameters like number of active threads, task queue size etc.</p>
<p>Before we can register a Gauge, we need to decide how to calculate a metric name for our thread pool. Each metric, whether it&rsquo;s a Gauge, or a Timer, or simply a Meter, has a unique name. This name is used to identify the metric source. The convention here is to use a dotted string which is often constructed from the fully qualified name of the class being monitored.</p>
<p>For our thread pool, we will be using its fully qualified name as a prefix to our metrics names. Additionally we will add another constructor parameter called <em>poolName,</em> which will be used by the clients to specify instance-specific identifiers.</p>
<p>After implementing these changes the class looks like below -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">MonitoredThreadPoolExecutor</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">extends</span><span style="color:#6e7681"> </span>ThreadPoolExecutor<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">final</span><span style="color:#6e7681"> </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">final</span><span style="color:#6e7681"> </span>String<span style="color:#6e7681"> </span>metricsPrefix;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>String<span style="color:#6e7681"> </span>poolName<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">this</span>.metricsPrefix<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>MetricRegistry.name(getClass(),<span style="color:#6e7681"> </span>poolName);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#8b949e;font-style:italic">// Rest of the constructors</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><p>Now we are ready to register our Gauges. For this purpose we will define a private method -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">registerGauges</span>()<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>metricRegistry.register(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;corePoolSize&#34;</span>),<span style="color:#6e7681"> </span>(Gauge<span style="color:#ff7b72;font-weight:bold">&lt;</span>Integer<span style="color:#ff7b72;font-weight:bold">&gt;</span>)<span style="color:#6e7681"> </span><span style="color:#ff7b72">this</span>::getCorePoolSize);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>metricRegistry.register(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;activeThreads&#34;</span>),<span style="color:#6e7681"> </span>(Gauge<span style="color:#ff7b72;font-weight:bold">&lt;</span>Integer<span style="color:#ff7b72;font-weight:bold">&gt;</span>)<span style="color:#6e7681"> </span><span style="color:#ff7b72">this</span>::getActiveCount);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>metricRegistry.register(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;maxPoolSize&#34;</span>),<span style="color:#6e7681"> </span>(Gauge<span style="color:#ff7b72;font-weight:bold">&lt;</span>Integer<span style="color:#ff7b72;font-weight:bold">&gt;</span>)<span style="color:#6e7681"> </span><span style="color:#ff7b72">this</span>::getMaximumPoolSize);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>metricRegistry.register(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;queueSize&#34;</span>),<span style="color:#6e7681"> </span>(Gauge<span style="color:#ff7b72;font-weight:bold">&lt;</span>Integer<span style="color:#ff7b72;font-weight:bold">&gt;</span>)<span style="color:#6e7681"> </span>()<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">-&gt;</span><span style="color:#6e7681"> </span>getQueue().size());<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><p>For our example we are measuring core pool size, number of active threads, maximum pool size, and task queue size. Depending on monitoring requirements we can register more/less Gauges to measure different properties.</p>
<p>This private method will now be invoked from all constructors -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">MonitoredThreadPoolExecutor</span>(<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>corePoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">int</span><span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">long</span><span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>TimeUnit<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>BlockingQueue<span style="color:#ff7b72;font-weight:bold">&lt;</span>Runnable<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>workQueue,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry,<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>String<span style="color:#6e7681"> </span>poolName<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">super</span>(corePoolSize,<span style="color:#6e7681"> </span>maximumPoolSize,<span style="color:#6e7681"> </span>keepAliveTime,<span style="color:#6e7681"> </span>unit,<span style="color:#6e7681"> </span>workQueue);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">this</span>.metricRegistry<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">this</span>.metricsPrefix<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>MetricRegistry.name(getClass(),<span style="color:#6e7681"> </span>poolName);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>registerGauges();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h2 id="measuring-task-execution-time">
  Measuring Task Execution Time
  <a class="heading-link" href="#measuring-task-execution-time">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>To measure the task execution time, we will override two life-cycle methods that <em>ThreadPoolExecutor</em> provides - <em>beforeExecute</em> and <em>afterExecute</em>.</p>
<p>As the name implies, <em>beforeExecute</em> callback is invoked prior to executing a task, by the thread that will execute the task. The default implementation of this callback does nothing.</p>
<p>Similarly, the <em>afterExecute</em> callback is invoked after each task is executed, by the thread that executed the task. The default implementation of this callback also does nothing. Even if the task throws an uncaught <em>RuntimeException</em> or <em>Error</em>, this callback will be invoked.</p>
<p>We will be starting a <a href="http://metrics.dropwizard.io/4.0.0/getting-started.html#timers"  class="external-link" target="_blank" rel="noopener">Timer</a> in our <em>beforeExecute</em> override, which will then be used in our <em>afterExecute</em> override to get the total task execution time. To store a reference to the <em>Timer</em> we will introduce a new <em>ThreadLocal</em> field in our class.</p>
<p>The implementation of the callbacks are given below -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">MonitoredThreadPoolExecutor</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">extends</span><span style="color:#6e7681"> </span>ThreadPoolExecutor<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">final</span><span style="color:#6e7681"> </span>MetricRegistry<span style="color:#6e7681"> </span>metricRegistry;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">final</span><span style="color:#6e7681"> </span>String<span style="color:#6e7681"> </span>metricsPrefix;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">private</span><span style="color:#6e7681"> </span>ThreadLocal<span style="color:#ff7b72;font-weight:bold">&lt;</span>Timer.Context<span style="color:#ff7b72;font-weight:bold">&gt;</span><span style="color:#6e7681"> </span>taskExecutionTimer<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">new</span><span style="color:#6e7681"> </span>ThreadLocal<span style="color:#ff7b72;font-weight:bold">&lt;&gt;</span>();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#8b949e;font-style:italic">// Constructors</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#d2a8ff;font-weight:bold">@Override</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">protected</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">beforeExecute</span>(Thread<span style="color:#6e7681"> </span>thread,<span style="color:#6e7681"> </span>Runnable<span style="color:#6e7681"> </span>task)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>.beforeExecute(thread,<span style="color:#6e7681"> </span>task);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>Timer<span style="color:#6e7681"> </span>timer<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry.timer(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;task-execution&#34;</span>));<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>taskExecutionTimer.set(timer.time());<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#d2a8ff;font-weight:bold">@Override</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">protected</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">afterExecute</span>(Runnable<span style="color:#6e7681"> </span>task,<span style="color:#6e7681"> </span>Throwable<span style="color:#6e7681"> </span>throwable)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>Timer.Context<span style="color:#6e7681"> </span>context<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>taskExecutionTimer.get();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>context.stop();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">super</span>.afterExecute(task,<span style="color:#6e7681"> </span>throwable);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h3 id="recording-number-of-failed-tasks-due-to-uncaught-exceptions">
  Recording number of failed tasks due to uncaught exceptions
  <a class="heading-link" href="#recording-number-of-failed-tasks-due-to-uncaught-exceptions">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The second parameter to the <em>afterExecute</em> callback is a <em>Throwable</em>. If non-null, this <em>Throwable</em> refers to the uncaught <em>RuntimeException</em> or <em>Error</em> that caused the execution to terminate. We can use this information to partially count the total number of tasks that were terminated abruptly due to uncaught exceptions.</p>
<p>To get the total number of failed tasks, we must consider another case. Tasks submitted using the <em>execute</em> method will throw any uncaught exceptions, and it will be available as the second argument to the <em>afterExecute</em> callback. However, tasks submitted using the <em>submit</em> method are swallowed by the executor service. This is clearly explained in the <a href="https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ThreadPoolExecutor.html#afterExecute%28java.lang.Runnable,java.lang.Throwable%29"  class="external-link" target="_blank" rel="noopener">JavaDoc</a> (emphasis mine) -</p>
<blockquote>
<p>Note: When actions are enclosed in tasks (such as FutureTask) either explicitly or via methods such as submit, these task objects catch and maintain computational exceptions, and so they do not cause abrupt termination, and <strong>the internal exceptions are not passed to this method</strong>. If you would like to trap both kinds of failures in this method, you can further probe for such cases, as in this sample subclass that prints either the direct cause or the underlying exception if a task has been aborted</p>
</blockquote>
<p>Fortunately, the same doc also offers a solution for this, which is to examine the runnable to see if it&rsquo;s a <em>Future</em>, and then get the underlying exception.</p>
<p>Combining these approaches, we can modify our <em>afterExecute</em> method as follows -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#d2a8ff;font-weight:bold">@Override</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">protected</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">afterExecute</span>(Runnable<span style="color:#6e7681"> </span>runnable,<span style="color:#6e7681"> </span>Throwable<span style="color:#6e7681"> </span>throwable)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>Timer.Context<span style="color:#6e7681"> </span>context<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>taskExecutionTimer.get();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>context.stop();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">super</span>.afterExecute(runnable,<span style="color:#6e7681"> </span>throwable);<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(throwable<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">==</span><span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span><span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span><span style="color:#6e7681"> </span>runnable<span style="color:#6e7681"> </span><span style="color:#ff7b72">instanceof</span><span style="color:#6e7681"> </span>Future<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span><span style="color:#6e7681"> </span>((Future)<span style="color:#6e7681"> </span>runnable).isDone())<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">try</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>((Future)<span style="color:#6e7681"> </span>runnable).get();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">catch</span><span style="color:#6e7681"> </span>(CancellationException<span style="color:#6e7681"> </span>ce)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>throwable<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>ce;<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">catch</span><span style="color:#6e7681"> </span>(ExecutionException<span style="color:#6e7681"> </span>ee)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>throwable<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>ee.getCause();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">catch</span><span style="color:#6e7681"> </span>(InterruptedException<span style="color:#6e7681"> </span>ie)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">      </span>Thread.currentThread().interrupt();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(throwable<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">!=</span><span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>Counter<span style="color:#6e7681"> </span>failedTasksCounter<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry.counter(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;failed-tasks&#34;</span>));<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>failedTasksCounter.inc();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h2 id="counting-total-number-of-successful-tasks">
  Counting total number of successful tasks
  <a class="heading-link" href="#counting-total-number-of-successful-tasks">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The previous approach can also be used to count the total number of successful tasks: tasks that were completed without throwing any exceptions or errors -</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#d2a8ff;font-weight:bold">@Override</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">protected</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:bold">afterExecute</span>(Runnable<span style="color:#6e7681"> </span>runnable,<span style="color:#6e7681"> </span>Throwable<span style="color:#6e7681"> </span>throwable)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#8b949e;font-style:italic">// Rest of the method body .....</span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(throwable<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">!=</span><span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>Counter<span style="color:#6e7681"> </span>failedTasksCounter<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry.counter(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;failed-tasks&#34;</span>));<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>failedTasksCounter.inc();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">else</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>Counter<span style="color:#6e7681"> </span>successfulTasksCounter<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#6e7681"> </span>metricRegistry.counter(MetricRegistry.name(metricsPrefix,<span style="color:#6e7681"> </span><span style="color:#a5d6ff">&#34;successful-tasks&#34;</span>));<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">    </span>successfulTasksCounter.inc();<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex;"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>In this article we have looked at a few monitoring-friendly customization to an ExecutorService implementation. Like always, any suggestions/improvements/bug fix will be highly appreciated. As for the example source code, it has been uploaded to <a href="https://github.com/sayembd/java-examples/blob/master/java-core/src/main/java/com/codesod/example/executor/MonitoredThreadPoolExecutor.java"  class="external-link" target="_blank" rel="noopener">Github</a>.</p>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script>
  window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    
    document.addEventListener('themeChanged', function (e) { 
        if (document.readyState == 'complete') {
          DISQUS.reset({ reload: true, config: disqus_config });
        }
    });
</script>
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2017 -
    
    2025
     MD Sayem Ahmed 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
