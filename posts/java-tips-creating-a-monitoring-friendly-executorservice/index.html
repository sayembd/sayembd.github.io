<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Java Tips: Creating a Monitoring-friendly ExecutorService | Random Musings</title><meta name=keywords content><meta name=description content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities."><meta name=author content><link rel=canonical href=https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/><link crossorigin=anonymous href=/assets/css/stylesheet.75e99ced767a858315a7f7639cf847a348c9cd6d87c9dfe94262be72551a789f.css integrity="sha256-demc7XZ6hYMVp/djnPhHo0jJzW2Hyd/pQmK+clUaeJ8=" rel="preload stylesheet" as=style><link rel=icon href=https://www.sayemahmed.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.sayemahmed.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.sayemahmed.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.sayemahmed.com/apple-touch-icon.png><link rel=mask-icon href=https://www.sayemahmed.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Java Tips: Creating a Monitoring-friendly ExecutorService"><meta property="og:description" content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities."><meta property="og:type" content="article"><meta property="og:url" content="https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-05-01T03:15:21+02:00"><meta property="article:modified_time" content="2018-05-01T03:15:21+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Java Tips: Creating a Monitoring-friendly ExecutorService"><meta name=twitter:description content="A custom ExecutorService implementation in Java, augmented with monitoring capabilities."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.sayemahmed.com/posts/"},{"@type":"ListItem","position":2,"name":"Java Tips: Creating a Monitoring-friendly ExecutorService","item":"https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Java Tips: Creating a Monitoring-friendly ExecutorService","name":"Java Tips: Creating a Monitoring-friendly ExecutorService","description":"A custom ExecutorService implementation in Java, augmented with monitoring capabilities.","keywords":[],"articleBody":"In this article we will be extending an ExecutorService implementation with monitoring capabilities. This monitoring capability will help us to measure a number of pool parameters i.e., active threads, work queue size etc. in a live production environment. It will also enable us to measure task execution time, successful tasks count, and failed tasks count.\nMonitoring Library As for the monitoring library we will be using Metrics. For the sake of simplicity we will be using a ConsoleReporter which will report our metrics to the console. For production-grade applications, we should use an advanced reporter (i.e., Graphite reporter). If you are unfamiliar with Metrics, then I recommend you to go through the getting started guide.\nLet’s get started.\nExtending the ThreadPoolExecutor We will be using ThreadPoolExecutor as the base class for our new type. Let’s call it MonitoredThreadPoolExecutor. This class will accept a MetricRegistry as one of its constructor parameters -\npublic class MonitoredThreadPoolExecutor extends ThreadPoolExecutor { private final MetricRegistry metricRegistry; public MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, MetricRegistry metricRegistry ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue); this.metricRegistry = metricRegistry; } public MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, ThreadFactory threadFactory, MetricRegistry metricRegistry ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory); this.metricRegistry = metricRegistry; } public MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, RejectedExecutionHandler handler, MetricRegistry metricRegistry ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, handler); this.metricRegistry = metricRegistry; } public MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler, MetricRegistry metricRegistry ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, threadFactory, handler); this.metricRegistry = metricRegistry; } } Registering Gauges to measure pool-specific paramters A Gauge is an instantaneous measurement of a value. We will be using it to measure different pool parameters like number of active threads, task queue size etc.\nBefore we can register a Gauge, we need to decide how to calculate a metric name for our thread pool. Each metric, whether it’s a Gauge, or a Timer, or simply a Meter, has a unique name. This name is used to identify the metric source. The convention here is to use a dotted string which is often constructed from the fully qualified name of the class being monitored.\nFor our thread pool, we will be using its fully qualified name as a prefix to our metrics names. Additionally we will add another constructor parameter called poolName, which will be used by the clients to specify instance-specific identifiers.\nAfter implementing these changes the class looks like below -\npublic class MonitoredThreadPoolExecutor extends ThreadPoolExecutor { private final MetricRegistry metricRegistry; private final String metricsPrefix; public MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, MetricRegistry metricRegistry, String poolName ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue); this.metricRegistry = metricRegistry; this.metricsPrefix = MetricRegistry.name(getClass(), poolName); } // Rest of the constructors } Now we are ready to register our Gauges. For this purpose we will define a private method -\nprivate void registerGauges() { metricRegistry.register(MetricRegistry.name(metricsPrefix, \"corePoolSize\"), (Gauge\u003cInteger\u003e) this::getCorePoolSize); metricRegistry.register(MetricRegistry.name(metricsPrefix, \"activeThreads\"), (Gauge\u003cInteger\u003e) this::getActiveCount); metricRegistry.register(MetricRegistry.name(metricsPrefix, \"maxPoolSize\"), (Gauge\u003cInteger\u003e) this::getMaximumPoolSize); metricRegistry.register(MetricRegistry.name(metricsPrefix, \"queueSize\"), (Gauge\u003cInteger\u003e) () -\u003e getQueue().size()); } For our example we are measuring core pool size, number of active threads, maximum pool size, and task queue size. Depending on monitoring requirements we can register more/less Gauges to measure different properties.\nThis private method will now be invoked from all constructors -\npublic MonitoredThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u003cRunnable\u003e workQueue, MetricRegistry metricRegistry, String poolName ) { super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue); this.metricRegistry = metricRegistry; this.metricsPrefix = MetricRegistry.name(getClass(), poolName); registerGauges(); } Measuring Task Execution Time To measure the task execution time, we will override two life-cycle methods that ThreadPoolExecutor provides - beforeExecute and afterExecute.\nAs the name implies, beforeExecute callback is invoked prior to executing a task, by the thread that will execute the task. The default implementation of this callback does nothing.\nSimilarly, the afterExecute callback is invoked after each task is executed, by the thread that executed the task. The default implementation of this callback also does nothing. Even if the task throws an uncaught RuntimeException or Error, this callback will be invoked.\nWe will be starting a Timer in our beforeExecute override, which will then be used in our afterExecute override to get the total task execution time. To store a reference to the Timer we will introduce a new ThreadLocal field in our class.\nThe implementation of the callbacks are given below -\npublic class MonitoredThreadPoolExecutor extends ThreadPoolExecutor { private final MetricRegistry metricRegistry; private final String metricsPrefix; private ThreadLocal\u003cTimer.Context\u003e taskExecutionTimer = new ThreadLocal\u003c\u003e(); // Constructors @Override protected void beforeExecute(Thread thread, Runnable task) { super.beforeExecute(thread, task); Timer timer = metricRegistry.timer(MetricRegistry.name(metricsPrefix, \"task-execution\")); taskExecutionTimer.set(timer.time()); } @Override protected void afterExecute(Runnable task, Throwable throwable) { Timer.Context context = taskExecutionTimer.get(); context.stop(); super.afterExecute(task, throwable); } } Recording number of failed tasks due to uncaught exceptions The second parameter to the afterExecute callback is a Throwable. If non-null, this Throwable refers to the uncaught RuntimeException or Error that caused the execution to terminate. We can use this information to partially count the total number of tasks that were terminated abruptly due to uncaught exceptions.\nTo get the total number of failed tasks, we must consider another case. Tasks submitted using the execute method will throw any uncaught exceptions, and it will be available as the second argument to the afterExecute callback. However, tasks submitted using the submit method are swallowed by the executor service. This is clearly explained in the JavaDoc (emphasis mine) -\nNote: When actions are enclosed in tasks (such as FutureTask) either explicitly or via methods such as submit, these task objects catch and maintain computational exceptions, and so they do not cause abrupt termination, and the internal exceptions are not passed to this method. If you would like to trap both kinds of failures in this method, you can further probe for such cases, as in this sample subclass that prints either the direct cause or the underlying exception if a task has been aborted\nFortunately, the same doc also offers a solution for this, which is to examine the runnable to see if it’s a Future, and then get the underlying exception.\nCombining these approaches, we can modify our afterExecute method as follows -\n@Override protected void afterExecute(Runnable runnable, Throwable throwable) { Timer.Context context = taskExecutionTimer.get(); context.stop(); super.afterExecute(runnable, throwable); if (throwable == null \u0026\u0026 runnable instanceof Future \u0026\u0026 ((Future) runnable).isDone()) { try { ((Future) runnable).get(); } catch (CancellationException ce) { throwable = ce; } catch (ExecutionException ee) { throwable = ee.getCause(); } catch (InterruptedException ie) { Thread.currentThread().interrupt(); } } if (throwable != null) { Counter failedTasksCounter = metricRegistry.counter(MetricRegistry.name(metricsPrefix, \"failed-tasks\")); failedTasksCounter.inc(); } } Counting total number of successful tasks The previous approach can also be used to count the total number of successful tasks: tasks that were completed without throwing any exceptions or errors -\n@Override protected void afterExecute(Runnable runnable, Throwable throwable) { // Rest of the method body ..... if (throwable != null) { Counter failedTasksCounter = metricRegistry.counter(MetricRegistry.name(metricsPrefix, \"failed-tasks\")); failedTasksCounter.inc(); } else { Counter successfulTasksCounter = metricRegistry.counter(MetricRegistry.name(metricsPrefix, \"successful-tasks\")); successfulTasksCounter.inc(); } } Conclusion In this article we have looked at a few monitoring-friendly customization to an ExecutorService implementation. Like always, any suggestions/improvements/bug fix will be highly appreciated. As for the example source code, it has been uploaded to Github.\n","wordCount":"1212","inLanguage":"en","datePublished":"2018-05-01T03:15:21+02:00","dateModified":"2018-05-01T03:15:21+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sayemahmed.com/posts/java-tips-creating-a-monitoring-friendly-executorservice/"},"publisher":{"@type":"Organization","name":"Random Musings","logo":{"@type":"ImageObject","url":"https://www.sayemahmed.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.sayemahmed.com accesskey=h title="Random Musings (Alt + H)">Random Musings</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.sayemahmed.com/about-me title="About Me"><span>About Me</span></a></li><li><a href=https://www.sayemahmed.com/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Java Tips: Creating a Monitoring-friendly ExecutorService</h1><div class=post-description>A custom ExecutorService implementation in Java, augmented with monitoring capabilities.</div><div class=post-meta><span title='2018-05-01 03:15:21 +0200 CEST'>May 1, 2018</span></div></header><div class=post-content><p>In this article we will be extending an <a href=https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ExecutorService.html>ExecutorService</a> implementation with monitoring capabilities. This monitoring capability will help us to measure a number of pool parameters i.e., active threads, work queue size etc. in a live production environment. It will also enable us to measure task execution time, successful tasks count, and failed tasks count.</p><h2 id=monitoring-library>Monitoring Library<a hidden class=anchor aria-hidden=true href=#monitoring-library>#</a></h2><p>As for the monitoring library we will be using <a href=http://metrics.dropwizard.io/>Metrics</a>. For the sake of simplicity we will be using a <a href=http://metrics.dropwizard.io/4.0.0/apidocs/com/codahale/metrics/ConsoleReporter.html>ConsoleReporter</a> which will report our metrics to the console. For production-grade applications, we should use an advanced reporter (i.e., Graphite reporter). If you are unfamiliar with Metrics, then I recommend you to go through the <a href=http://metrics.dropwizard.io/4.0.0/getting-started.html>getting started guide</a>.</p><p>Let&rsquo;s get started.</p><h2 id=extending-the-threadpoolexecutor>Extending the ThreadPoolExecutor<a hidden class=anchor aria-hidden=true href=#extending-the-threadpoolexecutor>#</a></h2><p>We will be using <a href=https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ThreadPoolExecutor.html>ThreadPoolExecutor</a> as the base class for our new type. Let&rsquo;s call it <em>MonitoredThreadPoolExecutor</em>. This class will accept a <a href=http://metrics.dropwizard.io/4.0.0/apidocs/com/codahale/metrics/MetricRegistry.html>MetricRegistry</a> as one of its constructor parameters -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MonitoredThreadPoolExecutor</span> <span class=kd>extends</span> <span class=n>ThreadPoolExecutor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>ThreadFactory</span> <span class=n>threadFactory</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>,</span> <span class=n>threadFactory</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>RejectedExecutionHandler</span> <span class=n>handler</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>,</span> <span class=n>handler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>ThreadFactory</span> <span class=n>threadFactory</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>RejectedExecutionHandler</span> <span class=n>handler</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>,</span> <span class=n>threadFactory</span><span class=o>,</span> <span class=n>handler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=registering-gauges-to-measure-pool-specific-paramters>Registering Gauges to measure pool-specific paramters<a hidden class=anchor aria-hidden=true href=#registering-gauges-to-measure-pool-specific-paramters>#</a></h2><p>A <a href=http://metrics.dropwizard.io/4.0.0/getting-started.html#gauges>Gauge</a> is an instantaneous measurement of a value. We will be using it to measure different pool parameters like number of active threads, task queue size etc.</p><p>Before we can register a Gauge, we need to decide how to calculate a metric name for our thread pool. Each metric, whether it&rsquo;s a Gauge, or a Timer, or simply a Meter, has a unique name. This name is used to identify the metric source. The convention here is to use a dotted string which is often constructed from the fully qualified name of the class being monitored.</p><p>For our thread pool, we will be using its fully qualified name as a prefix to our metrics names. Additionally we will add another constructor parameter called <em>poolName,</em> which will be used by the clients to specify instance-specific identifiers.</p><p>After implementing these changes the class looks like below -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MonitoredThreadPoolExecutor</span> <span class=kd>extends</span> <span class=n>ThreadPoolExecutor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>metricsPrefix</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>String</span> <span class=n>poolName</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>metricsPrefix</span> <span class=o>=</span> <span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>getClass</span><span class=o>(),</span> <span class=n>poolName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Rest of the constructors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>Now we are ready to register our Gauges. For this purpose we will define a private method -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>registerGauges</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>metricRegistry</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;corePoolSize&#34;</span><span class=o>),</span> <span class=o>(</span><span class=n>Gauge</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;)</span> <span class=k>this</span><span class=o>::</span><span class=n>getCorePoolSize</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>metricRegistry</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;activeThreads&#34;</span><span class=o>),</span> <span class=o>(</span><span class=n>Gauge</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;)</span> <span class=k>this</span><span class=o>::</span><span class=n>getActiveCount</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>metricRegistry</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;maxPoolSize&#34;</span><span class=o>),</span> <span class=o>(</span><span class=n>Gauge</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;)</span> <span class=k>this</span><span class=o>::</span><span class=n>getMaximumPoolSize</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>metricRegistry</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;queueSize&#34;</span><span class=o>),</span> <span class=o>(</span><span class=n>Gauge</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;)</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>getQueue</span><span class=o>().</span><span class=na>size</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>For our example we are measuring core pool size, number of active threads, maximum pool size, and task queue size. Depending on monitoring requirements we can register more/less Gauges to measure different properties.</p><p>This private method will now be invoked from all constructors -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=nf>MonitoredThreadPoolExecutor</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>corePoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>maximumPoolSize</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>long</span> <span class=n>keepAliveTime</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TimeUnit</span> <span class=n>unit</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BlockingQueue</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>workQueue</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>poolName</span>
</span></span><span class=line><span class=cl><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>super</span><span class=o>(</span><span class=n>corePoolSize</span><span class=o>,</span> <span class=n>maximumPoolSize</span><span class=o>,</span> <span class=n>keepAliveTime</span><span class=o>,</span> <span class=n>unit</span><span class=o>,</span> <span class=n>workQueue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=o>.</span><span class=na>metricRegistry</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=o>.</span><span class=na>metricsPrefix</span> <span class=o>=</span> <span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>getClass</span><span class=o>(),</span> <span class=n>poolName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>registerGauges</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=measuring-task-execution-time>Measuring Task Execution Time<a hidden class=anchor aria-hidden=true href=#measuring-task-execution-time>#</a></h2><p>To measure the task execution time, we will override two life-cycle methods that <em>ThreadPoolExecutor</em> provides - <em>beforeExecute</em> and <em>afterExecute</em>.</p><p>As the name implies, <em>beforeExecute</em> callback is invoked prior to executing a task, by the thread that will execute the task. The default implementation of this callback does nothing.</p><p>Similarly, the <em>afterExecute</em> callback is invoked after each task is executed, by the thread that executed the task. The default implementation of this callback also does nothing. Even if the task throws an uncaught <em>RuntimeException</em> or <em>Error</em>, this callback will be invoked.</p><p>We will be starting a <a href=http://metrics.dropwizard.io/4.0.0/getting-started.html#timers>Timer</a> in our <em>beforeExecute</em> override, which will then be used in our <em>afterExecute</em> override to get the total task execution time. To store a reference to the <em>Timer</em> we will introduce a new <em>ThreadLocal</em> field in our class.</p><p>The implementation of the callbacks are given below -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MonitoredThreadPoolExecutor</span> <span class=kd>extends</span> <span class=n>ThreadPoolExecutor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>MetricRegistry</span> <span class=n>metricRegistry</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>metricsPrefix</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>ThreadLocal</span><span class=o>&lt;</span><span class=n>Timer</span><span class=o>.</span><span class=na>Context</span><span class=o>&gt;</span> <span class=n>taskExecutionTimer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ThreadLocal</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Constructors
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>beforeExecute</span><span class=o>(</span><span class=n>Thread</span> <span class=n>thread</span><span class=o>,</span> <span class=n>Runnable</span> <span class=n>task</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>.</span><span class=na>beforeExecute</span><span class=o>(</span><span class=n>thread</span><span class=o>,</span> <span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Timer</span> <span class=n>timer</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>.</span><span class=na>timer</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;task-execution&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>taskExecutionTimer</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>timer</span><span class=o>.</span><span class=na>time</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>afterExecute</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>task</span><span class=o>,</span> <span class=n>Throwable</span> <span class=n>throwable</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Timer</span><span class=o>.</span><span class=na>Context</span> <span class=n>context</span> <span class=o>=</span> <span class=n>taskExecutionTimer</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>context</span><span class=o>.</span><span class=na>stop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>.</span><span class=na>afterExecute</span><span class=o>(</span><span class=n>task</span><span class=o>,</span> <span class=n>throwable</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=recording-number-of-failed-tasks-due-to-uncaught-exceptions>Recording number of failed tasks due to uncaught exceptions<a hidden class=anchor aria-hidden=true href=#recording-number-of-failed-tasks-due-to-uncaught-exceptions>#</a></h3><p>The second parameter to the <em>afterExecute</em> callback is a <em>Throwable</em>. If non-null, this <em>Throwable</em> refers to the uncaught <em>RuntimeException</em> or <em>Error</em> that caused the execution to terminate. We can use this information to partially count the total number of tasks that were terminated abruptly due to uncaught exceptions.</p><p>To get the total number of failed tasks, we must consider another case. Tasks submitted using the <em>execute</em> method will throw any uncaught exceptions, and it will be available as the second argument to the <em>afterExecute</em> callback. However, tasks submitted using the <em>submit</em> method are swallowed by the executor service. This is clearly explained in the <a href=https://docs.oracle.com/javase/10/docs/api/java/util/concurrent/ThreadPoolExecutor.html#afterExecute(java.lang.Runnable,java.lang.Throwable)>JavaDoc</a> (emphasis mine) -</p><blockquote><p>Note: When actions are enclosed in tasks (such as FutureTask) either explicitly or via methods such as submit, these task objects catch and maintain computational exceptions, and so they do not cause abrupt termination, and <strong>the internal exceptions are not passed to this method</strong>. If you would like to trap both kinds of failures in this method, you can further probe for such cases, as in this sample subclass that prints either the direct cause or the underlying exception if a task has been aborted</p></blockquote><p>Fortunately, the same doc also offers a solution for this, which is to examine the runnable to see if it&rsquo;s a <em>Future</em>, and then get the underlying exception.</p><p>Combining these approaches, we can modify our <em>afterExecute</em> method as follows -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>afterExecute</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>runnable</span><span class=o>,</span> <span class=n>Throwable</span> <span class=n>throwable</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Timer</span><span class=o>.</span><span class=na>Context</span> <span class=n>context</span> <span class=o>=</span> <span class=n>taskExecutionTimer</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=n>context</span><span class=o>.</span><span class=na>stop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>super</span><span class=o>.</span><span class=na>afterExecute</span><span class=o>(</span><span class=n>runnable</span><span class=o>,</span> <span class=n>throwable</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>(</span><span class=n>throwable</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>runnable</span> <span class=k>instanceof</span> <span class=n>Future</span> <span class=o>&amp;&amp;</span> <span class=o>((</span><span class=n>Future</span><span class=o>)</span> <span class=n>runnable</span><span class=o>).</span><span class=na>isDone</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=o>((</span><span class=n>Future</span><span class=o>)</span> <span class=n>runnable</span><span class=o>).</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>CancellationException</span> <span class=n>ce</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>throwable</span> <span class=o>=</span> <span class=n>ce</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>ExecutionException</span> <span class=n>ee</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>throwable</span> <span class=o>=</span> <span class=n>ee</span><span class=o>.</span><span class=na>getCause</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ie</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Thread</span><span class=o>.</span><span class=na>currentThread</span><span class=o>().</span><span class=na>interrupt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>(</span><span class=n>throwable</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Counter</span> <span class=n>failedTasksCounter</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>.</span><span class=na>counter</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;failed-tasks&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>failedTasksCounter</span><span class=o>.</span><span class=na>inc</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=counting-total-number-of-successful-tasks>Counting total number of successful tasks<a hidden class=anchor aria-hidden=true href=#counting-total-number-of-successful-tasks>#</a></h2><p>The previous approach can also be used to count the total number of successful tasks: tasks that were completed without throwing any exceptions or errors -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>afterExecute</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>runnable</span><span class=o>,</span> <span class=n>Throwable</span> <span class=n>throwable</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Rest of the method body .....
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>(</span><span class=n>throwable</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Counter</span> <span class=n>failedTasksCounter</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>.</span><span class=na>counter</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;failed-tasks&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>failedTasksCounter</span><span class=o>.</span><span class=na>inc</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Counter</span> <span class=n>successfulTasksCounter</span> <span class=o>=</span> <span class=n>metricRegistry</span><span class=o>.</span><span class=na>counter</span><span class=o>(</span><span class=n>MetricRegistry</span><span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=n>metricsPrefix</span><span class=o>,</span> <span class=s>&#34;successful-tasks&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>successfulTasksCounter</span><span class=o>.</span><span class=na>inc</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>In this article we have looked at a few monitoring-friendly customization to an ExecutorService implementation. Like always, any suggestions/improvements/bug fix will be highly appreciated. As for the example source code, it has been uploaded to <a href=https://github.com/sayembd/java-examples/blob/master/java-core/src/main/java/com/codesod/example/executor/MonitoredThreadPoolExecutor.java>Github</a>.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.sayemahmed.com/posts/a-brief-overview-of-the-fork-join-framework-in-java/><span class=title>« Prev</span><br><span>A Brief Overview of the Fork Join Framework in Java</span></a>
<a class=next href=https://www.sayemahmed.com/posts/jpa-tips-avoiding-the-n-plus-1-select-problem/><span class=title>Next »</span><br><span>Jpa Tips: Avoiding the N + 1 Select Problem</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on x" href="https://x.com/intent/tweet/?text=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService&amp;url=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f&amp;title=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService&amp;summary=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService&amp;source=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f&title=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on whatsapp" href="https://api.whatsapp.com/send?text=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService%20-%20https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on telegram" href="https://telegram.me/share/url?text=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService&amp;url=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Java Tips: Creating a Monitoring-friendly ExecutorService on ycombinator" href="https://news.ycombinator.com/submitlink?t=Java%20Tips%3a%20Creating%20a%20Monitoring-friendly%20ExecutorService&u=https%3a%2f%2fwww.sayemahmed.com%2fposts%2fjava-tips-creating-a-monitoring-friendly-executorservice%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://www.sayemahmed.com>Random Musings</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>