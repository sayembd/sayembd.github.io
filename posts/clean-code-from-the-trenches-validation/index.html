<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Clean Code From the Trenches Validation | Random Musings</title><meta name=keywords content><meta name=description content="Validation using the Composite Pattern in Java. Also demonstrates clean coding practice."><meta name=author content><link rel=canonical href=https://www.sayemahmed.com/posts/clean-code-from-the-trenches-validation/><link crossorigin=anonymous href=/assets/css/stylesheet.min.5fc7093e58e5038c03e70b417ab8f50482ebc513e1b1e74b0e42a004bc7ce7ed.css integrity="sha256-X8cJPljlA4wD5wtBerj1BILrxRPhsedLDkKgBLx85+0=" rel="preload stylesheet" as=style><link rel=icon href=https://www.sayemahmed.com/favicon.ico><link rel=apple-touch-icon href=https://www.sayemahmed.com/apple-touch-icon.png><meta name=twitter:title content="Clean Code From the Trenches Validation | Random Musings"><meta name=twitter:description content="Validation using the Composite Pattern in Java. Also demonstrates clean coding practice."><meta name=twitter:site content="@novoreorx"><meta name=twitter:creator content="@novoreorx"><meta property="og:title" content="Clean Code From the Trenches Validation | Random Musings"><meta property="og:description" content="Validation using the Composite Pattern in Java. Also demonstrates clean coding practice."><meta property="og:type" content="article"><meta property="og:url" content="https://www.sayemahmed.com/posts/clean-code-from-the-trenches-validation/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-05-12T00:50:12+02:00"><meta property="article:modified_time" content="2017-05-12T00:50:12+02:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.sayemahmed.com/posts/"},{"@type":"ListItem","position":3,"name":"Clean Code From the Trenches Validation","item":"https://www.sayemahmed.com/posts/clean-code-from-the-trenches-validation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Clean Code From the Trenches Validation | Random Musings","name":"Clean Code From the Trenches Validation","description":"Validation using the Composite Pattern in Java. Also demonstrates clean coding practice.","keywords":[],"wordCount":"1197","inLanguage":"en","datePublished":"2017-05-12T00:50:12+02:00","dateModified":"2017-05-12T00:50:12+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sayemahmed.com/posts/clean-code-from-the-trenches-validation/"},"publisher":{"@type":"Organization","name":"Random Musings","logo":{"@type":"ImageObject","url":"https://www.sayemahmed.com/favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="light",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://www.sayemahmed.com accesskey=h title="Random Musings (Alt + H)">Random Musings</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.sayemahmed.com/about-me/ title="About Me">About Me</a></li><li><a href=https://www.sayemahmed.com/index.xml/ title=RSS>RSS</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Clean Code From the Trenches Validation</h1><div class=post-description>Validation using the Composite Pattern in Java. Also demonstrates clean coding practice.</div><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>May 12, 2017</span></span></div></header><div class=post-content><p>Let&rsquo;s directly start with an example. Consider a simple web service which allows clients to place order to a shop. A very simplified version of the order controller could look something like below -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=n>value</span> <span class=o>=</span> <span class=s>&#34;/&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>consumes</span> <span class=o>=</span> <span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON_VALUE</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>produces</span> <span class=o>=</span> <span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON_VALUE</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OrderController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>OrderService</span> <span class=n>orderService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>OrderController</span><span class=o>(</span><span class=n>OrderService</span> <span class=n>orderService</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>orderService</span> <span class=o>=</span> <span class=n>orderService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@PostMapping</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doSomething</span><span class=o>(</span><span class=nd>@Valid</span> <span class=nd>@RequestBody</span> <span class=n>OrderDTO</span> <span class=n>order</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>orderService</span><span class=o>.</span><span class=na>createOrder</span><span class=o>(</span><span class=n>order</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>And the corresponding DTO class -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Getter</span>
</span></span><span class=line><span class=cl><span class=nd>@Setter</span>
</span></span><span class=line><span class=cl><span class=nd>@ToString</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OrderDTO</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>String</span> <span class=n>customerId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@NotNull</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Size</span><span class=o>(</span><span class=n>min</span> <span class=o>=</span> <span class=n>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItem</span><span class=o>&gt;</span> <span class=n>orderItems</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Getter</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Setter</span>
</span></span><span class=line><span class=cl>  <span class=nd>@ToString</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>OrderItem</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>menuId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>price</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Integer</span> <span class=n>quantity</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>The most common approach for creating an order from this DTO is to pass it to a service, validate it as necessary, and then persist it in the database -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OrderService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>MenuRepository</span> <span class=n>menuRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>OrderService</span><span class=o>(</span><span class=n>MenuRepository</span> <span class=n>menuRepository</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>menuRepository</span> <span class=o>=</span> <span class=n>menuRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>createOrder</span><span class=o>(</span><span class=n>OrderDTO</span> <span class=n>orderDTO</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>orderDTO</span><span class=o>.</span><span class=na>getOrderItems</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>validate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Order {} saved&#34;</span><span class=o>,</span> <span class=n>orderDTO</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>menuId</span> <span class=o>=</span> <span class=n>orderItem</span><span class=o>.</span><span class=na>getMenuId</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>menuId</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>menuId</span><span class=o>.</span><span class=na>trim</span><span class=o>().</span><span class=na>isEmpty</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;A menu item must be specified.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(!</span><span class=n>menuRepository</span><span class=o>.</span><span class=na>menuExists</span><span class=o>(</span><span class=n>menuId</span><span class=o>.</span><span class=na>trim</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given menu &#34;</span> <span class=o>+</span> <span class=n>menuId</span> <span class=o>+</span> <span class=s>&#34; does not exist.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>description</span> <span class=o>=</span> <span class=n>orderItem</span><span class=o>.</span><span class=na>getDescription</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>description</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>description</span><span class=o>.</span><span class=na>trim</span><span class=o>().</span><span class=na>isEmpty</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Item description should be provided&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>price</span> <span class=o>=</span> <span class=n>orderItem</span><span class=o>.</span><span class=na>getPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>price</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>price</span><span class=o>.</span><span class=na>trim</span><span class=o>().</span><span class=na>isEmpty</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Price cannot be empty.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>BigDecimal</span><span class=o>(</span><span class=n>price</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given price is not in valid format&#34;</span><span class=o>,</span> <span class=n>ex</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>orderItem</span><span class=o>.</span><span class=na>getQuantity</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Quantity must be given&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>orderItem</span><span class=o>.</span><span class=na>getQuantity</span><span class=o>()</span> <span class=o>&lt;=</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given quantity &#34;</span>
</span></span><span class=line><span class=cl>          <span class=o>+</span> <span class=n>orderItem</span><span class=o>.</span><span class=na>getQuantity</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>+</span> <span class=s>&#34; is not valid.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>The validate method is not well written. It is very hard to test. Introducing new validation rule in the future is also hard, and so is removing/modifying any of the existing ones. From my experience I have seen that most people write a few generic assertions for this type of validation check, typically in an integration test class, touching only one or two (or more, but not all) of the validation rules. As a result, refactoring in the future can only be done in <strong><em><a href=https://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052>Edit and Pray</a></em></strong> mode.</p><p>We can improve the code structure if we use Polymorphism to replace these conditionals. Let&rsquo;s create a common super type for representing a single validation rule -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span> 
</span></span></code></pre></div><p>Next step is to create validation rule implementations which will focus on separate validation areas for the DTO. Let&rsquo;s start with the menu validator -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MenuValidator</span> <span class=kd>implements</span> <span class=n>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>MenuRepository</span> <span class=n>menuRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>MenuValidator</span><span class=o>(</span><span class=n>MenuRepository</span> <span class=n>menuRepository</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>menuRepository</span> <span class=o>=</span> <span class=n>menuRepository</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>menuId</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>orderItem</span><span class=o>.</span><span class=na>getMenuId</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>trim</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>id</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>id</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>orElseThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;A menu item must be specified.&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(!</span><span class=n>menuRepository</span><span class=o>.</span><span class=na>menuExists</span><span class=o>(</span><span class=n>menuId</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given menu [&#34;</span> <span class=o>+</span> <span class=n>menuId</span> <span class=o>+</span> <span class=s>&#34;] does not exist.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Then the item description validator -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ItemDescriptionValidator</span> <span class=kd>implements</span> <span class=n>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>orderItem</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>OrderItem</span><span class=o>::</span><span class=n>getDescription</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>trim</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>description</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>description</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>orElseThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Item description should be provided&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Price validator -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PriceValidator</span> <span class=kd>implements</span> <span class=n>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>price</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>orderItem</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>OrderItem</span><span class=o>::</span><span class=n>getPrice</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>trim</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>itemPrice</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>itemPrice</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>orElseThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Price cannot be empty.&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>BigDecimal</span><span class=o>(</span><span class=n>price</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>ex</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given price [&#34;</span> <span class=o>+</span> <span class=n>price</span> <span class=o>+</span> <span class=s>&#34;] is not in valid format&#34;</span><span class=o>,</span> <span class=n>ex</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>And finally, the quantity validator -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>QuantityValidator</span> <span class=kd>implements</span> <span class=n>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Integer</span> <span class=n>quantity</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>orderItem</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>OrderItem</span><span class=o>::</span><span class=n>getQuantity</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>orElseThrow</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Quantity must be given&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>quantity</span> <span class=o>&lt;=</span> <span class=n>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span><span class=s>&#34;Given quantity &#34;</span> <span class=o>+</span> <span class=n>quantity</span> <span class=o>+</span> <span class=s>&#34; is not valid.&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Each of these validator implementations can now be easily tested, independently from each other. Reasoning about each one of them also becomes easier. and so are future addition/modification/removal.</p><p>Now the wiring part. How can we integrate these validators with the order service?</p><p>One way would be to directly create a list in the OrderService constructor, and populate it with the validators. Or we could use Spring to inject a List into the OrderService -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OrderService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItemValidator</span><span class=o>&gt;</span> <span class=n>validators</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>OrderService</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItemValidator</span><span class=o>&gt;</span> <span class=n>validators</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>validators</span> <span class=o>=</span> <span class=n>validators</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>createOrder</span><span class=o>(</span><span class=n>OrderDTO</span> <span class=n>orderDTO</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>orderDTO</span><span class=o>.</span><span class=na>getOrderItems</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>validate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Order {} saved&#34;</span><span class=o>,</span> <span class=n>orderDTO</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>validators</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>validator</span> <span class=o>-&gt;</span> <span class=n>validator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=n>orderItem</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>In order for this to work we will have to declare each of the validator implementations as a Spring Bean.</p><p>We could improve our abstraction even further. The OrderService is now accepting a List of the validators. However, we can change it to be only aware of the OrderItemValidator type, and nothing else. This gives us the flexibility of injecting either a single validator or any composition of validators in the future.</p><p>So now our goal is to change the order service to treat a composition of order item validators in the same way as a single validator. There is a well-known design pattern called <a href=https://sourcemaking.com/design_patterns/composite>Composite</a> which lets us do exactly that.</p><p>Let&rsquo;s create a new implementation of the validator interface, which will be the composite -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OrderItemValidatorComposite</span> <span class=kd>implements</span> <span class=n>OrderItemValidator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItemValidator</span><span class=o>&gt;</span> <span class=n>validators</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>OrderItemValidatorComposite</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>OrderItemValidator</span><span class=o>&gt;</span> <span class=n>validators</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>validators</span> <span class=o>=</span> <span class=n>validators</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>validate</span><span class=o>(</span><span class=n>OrderItem</span> <span class=n>orderItem</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>validators</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>validator</span> <span class=o>-&gt;</span> <span class=n>validator</span><span class=o>.</span><span class=na>validate</span><span class=o>(</span><span class=n>orderItem</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>We then create a new Spring configuration class, which will instantiate and initialize this composite, and then expose it as a bean -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>ValidatorConfiguration</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>  <span class=n>OrderItemValidator</span> <span class=nf>orderItemValidator</span><span class=o>(</span><span class=n>MenuRepository</span> <span class=n>menuRepository</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>OrderItemValidatorComposite</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>MenuValidator</span><span class=o>(</span><span class=n>menuRepository</span><span class=o>),</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ItemDescriptionValidator</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>PriceValidator</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>QuantityValidator</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>We then change the OrderService class in the following way -</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OrderService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>OrderItemValidator</span> <span class=n>validator</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>OrderService</span><span class=o>(</span><span class=n>OrderItemValidator</span> <span class=n>orderItemValidator</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>validator</span> <span class=o>=</span> <span class=n>orderItemValidator</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>createOrder</span><span class=o>(</span><span class=n>OrderDTO</span> <span class=n>orderDTO</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>orderDTO</span><span class=o>.</span><span class=na>getOrderItems</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>validator</span><span class=o>::</span><span class=n>validate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Order {} saved&#34;</span><span class=o>,</span> <span class=n>orderDTO</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>And we are done!</p><p>The benefits of this approach are many. The whole validation logic has completely been abstracted away from the ordering service. Testing is easier. Future maintenance is easier. Clients only know about one validator type, and nothing else.</p><p>However, all of the above come with some problems too. Sometimes people are not comfortable with this design. They may feel like this is just too much abstraction, or that they will not be needing this much flexibility or testability for future maintenance. I&rsquo;d suggest to adopt this approach based on the team culture. After all, there is no single right way of doing things in Software Development.</p><p>Note that for the sake of this article I have taken some short cuts here as well. These includes throwing a generic IllegalArgumentException when validation fails. You&rsquo;d probably want a more specific/custom exception in a production-grade application to identify between different scenarios. The decimal parsing is also done naively, you might want to fix on a specific format, and then use DecimalFormat to parse it.</p><p>The full code has been uploaded to <a href=https://github.com/sayembd/java-examples/tree/20170511-clean-code-from-the-trenches-validation/java-validation>Github</a>.</p><p>If you find any typo/other errors please feel free to comment in!</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://www.sayemahmed.com/posts/jpa-tips-avoiding-the-n-plus-1-select-problem/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Jpa Tips: Avoiding the N + 1 Select Problem</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.sayemahmed.com>Random Musings</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a></span>
<span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a=""=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>